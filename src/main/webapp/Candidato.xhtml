<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      >
    <body>
<ui:composition template="layout.xhtml">
  <ui:define name="replace">         
  	<f:metadata>
    	<f:event listener="#{indexe.before}" type="preRenderView" />
   	</f:metadata>
    <h:form id="frmListagem" name="frmListagem" >
    	<p:messages id="messagesListagem" showDetail="true" closable="true"></p:messages>
    	<h:panelGrid columns="3" cellpadding="2" id="tabelaEleicao">
    		<f:facet name="header">
				<h1>
					<h:outputText value ="Eleições"  />
				</h1>
			</f:facet>
			<p:dataTable var="elemento" value="#{eleicaoCandidato.eleicoes}">
				<p:column headerText="Nome">
					<h:outputText value="#{elemento.nome}" />
				</p:column> 
				<p:column headerText="Descrição">
					<h:outputText value="#{elemento.descricao}" />
				</p:column>
				<p:column headerText="Opções">
					<p:commandButton update="formCargo" oncomplete="PF('cargos').show()" icon="ui-icon ui-icon-plus" title="Cargos">
                		<f:setPropertyActionListener value="#{elemento}" target="#{eleicaoCandidato.selecionado}" />
               		</p:commandButton>
				</p:column>    
			</p:dataTable>
			<f:facet name="footer">
										
	    	</f:facet>
			
		</h:panelGrid>
    </h:form>
    <p:dialog  header="Cargos Disponíveis" widgetVar="cargos"  showEffect="fade" hideEffect="fade">
    	<p:outputPanel id="formCargo" name="formCargo" style="text-align:center;">
    		<h:form id="frmCargo" name="frmCargo" >
   				<p:messages id="messages_cargo" showDetail="true" closable="true"></p:messages>
    			<div>
    				<ui:repeat value="#{eleicaoCandidato.selecionado.cargos}" var="cargo" rendered="#{eleicaoCandidato.selecionado.cargos.size() > 0}" varStatus="stat">
 						<h:panelGrid columns="3" style="width:100%" >	
	 						<h:outputText value="#{eleicaoCandidato.selecionado.cargos[stat.index].nome}" />
	 						<p:inputText name="nome_cargo" disabled="true"  value="#{eleicaoCandidato.selecionado.cargos[stat.index].quantidade}"></p:inputText>
 						<p:commandButton action="#{eleicaoCandidato.gerarVagas()}" update="formCargo, formVaga" oncomplete="PF('vagas').show()" icon="ui-icon ui-icon-plus" title="Adicionar candidatos ao cargo">
	 							<f:setPropertyActionListener value="#{eleicaoCandidato.selecionado.cargos[stat.index]}" target="#{eleicaoCandidato.cargoSelecionado}" />
	 						</p:commandButton>
 						</h:panelGrid>
 					</ui:repeat>
    			</div>
    		</h:form>
    	</p:outputPanel>
    </p:dialog>
    
    <p:dialog  header="Vagas do cargo selecionado" widgetVar="vagas"  showEffect="fade" hideEffect="fade">
    	<p:outputPanel id="formVaga" name="formVaga" style="text-align:center;">
    		<h:form id="frmVaga" name="frmVaga" >
    			<p:messages id="messages_vaga" showDetail="true" closable="true"></p:messages>
    			<div>
    				<ui:repeat value="#{eleicaoCandidato.vagas}" var="lacuna" rendered="#{eleicaoCandidato.vagas.size() > 0}" varStatus="stat">
                    	<h:panelGrid columns="3" style="width:100%" >
                    		<h:outputLabel value="Cargo : #{stat.index} "/>
                    		
                    	</h:panelGrid>        				
    				</ui:repeat>
    			</div>
    		</h:form>
    	</p:outputPanel>
    </p:dialog>
    
    <p:dialog  header="Candidatos" widgetVar="candidatos"  showEffect="fade" hideEffect="fade">
    	<p:outputPanel id="formCandidato" name="formCandidato" style="text-align:center;">
    		<h:form id="frmCandidato" name="frmCandidato" enctype="multipart/form-data">
    			<p:messages id="messages_candidato" showDetail="true" closable="true"></p:messages>
    			<h:panelGrid columns="2" cellpadding="2" id="tabelaEleicao">
    				<f:facet name="header">
						<h1>
							<h:outputText value ="Inclusão de candidato"  />
						</h1>						
					</f:facet>
					
					<h:outputLabel value="CPF:" for="cpf"/>
					<p:inputMask mask="999.999.999-99" title="CPF" id="cpf" name="cpf" value="#{candidato.informacoes.cpf}" required="true" requiredMessage="Campo CPF precisa ter valores">
						<f:validator validatorId="custom.cpfValidator" />
					</p:inputMask>
					
					<h:outputLabel value="Nome:" for="nome"/>
					<p:inputText id="nome" name="nome" value="#{candidato.informacoes.nome}" title="Nome" required="true" requiredMessage="Campo Nome deve ser digitado"></p:inputText>
					
					<h:outputLabel value="Sobrenome:" for="sobrenome"/>
					<p:inputText id="sobrenome" name="sobrenome" value="#{candidato.informacoes.sobrenome}" title="Sobrenome" required="true" requiredMessage="Campo Sobrenome deve ser digitado"></p:inputText>
					
					<h:outputLabel value="Data de Nascimento:" for="data_nasc"/>
					<p:calendar title="Data de Nascimento" id="data_nasc" value="#{candidato.informacoes.dataNascimento}" mode="popup" required="true" requiredMessage="Campo Data de Nascimento deve ser preenchido" effect="fade"  />
					
					<h:outputLabel value="Gênero:" for="genero"/>
					<p:selectOneMenu id="genero" value="#{candidato.informacoes.genero}" name="genero" title="Gênero" required="true" requiredMessage="Campo Gênero deve ser selecionado"  >
						<f:selectItem itemLabel="Selecione" itemValue="" />
						<f:selectItem itemLabel="Masculino" itemValue="M" />
            			<f:selectItem itemLabel="Feminino" itemValue="F" />
					</p:selectOneMenu>
					
					 
					<p:fileUpload  id="upload" value="#{candidato.file}" multiple="false"  auto="true" update="formCandidato"  />
					
					<f:facet name="footer">
						<p:commandButton  value="incluir" icon="ui-icon-save"  action="#{candidato.incluir}" update="formCandidato" ajax="true" />
						<p:commandButton  value="Limpar" icon="ui-icon-trash" process="@this" update="formCandidato" ajax="true" immediate="true" >
							<p:resetInput target="formCandidato" />
						</p:commandButton>
	    			</f:facet>
			
		</h:panelGrid>
    		</h:form>
    	</p:outputPanel>
    </p:dialog>
  </ui:define>
</ui:composition>
</body>
</html>